
CALFUSEDIR=	${PWD}/..
PLATFORM=	ix86_Linux
SHARED=		-shared
FITSVER=	2.470

# Symbols for make
MAKE=		make

#Symbols used for compiling
CC=		cc
OPT=		-Wall -g -DCFORTRAN -Dg77Fortran -Df2cFortran
CFLAGS=		${OPT} -I${CALFUSEDIR}/include
LIBS=		-lc -lm -lnsl -ldl -lgfortran

all:		lib bin fes jitter

lib:		libcfitsio libsla libfuse

install:	libinstall bininstall analinstall jitinstall # fesinstall

libinstall:	libcfitsioinstall libslainstall libfuseinstall

clean:		binclean fesclean analclean libclean jitclean

distclean:	bindistclean fesdistclean analdistclean libdistclean jitdistclean

libclean:	libcfitsioclean libslaclean libfuseclean

libdistclean:	libcfitsiodistclean libsladistclean libfusedistclean

cfitsio/Makefile:
		cd cfitsio; CC="${CC}"; export CC; ./configure;

libcfitsio.so:
		cd cfitsio; /bin/rm -f libcfitsio-${FITSVER}.so

libcfitsio:	cfitsio/Makefile
		cd cfitsio; ${MAKE} CFLAGS="${OPT}"; \
		${CC} ${SHARED} -o libcfitsio-${FITSVER}.so *.o ${LIBS}

libsla:		
		SYSTEM="${PLATFORM}"; export SYSTEM; \
		FFLAGS="${OPT}"; export FFLAGS; \
		cd slalib; ./mk build; ${CC} ${SHARED} -o libsla.so *.o ${LIBS}

libfuse:
		cd libcf; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" FITSVER=${FITSVER} all

bin:
		cd fuv; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" FITSVER=${FITSVER} all

fes:
		cd fes; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" FITSVER=${FITSVER} all

analysis:
		cd analysis; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" FITSVER=${FITSVER} all

jitter:
		cd cal/jitter; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" FITSVER=${FITSVER} all

libcfitsioinstall: libcfitsio
		cd cfitsio; cp libcfitsio-${FITSVER}.so ${CALFUSEDIR}/lib

libslainstall:	libsla
		cd slalib; cp libsla.so ${CALFUSEDIR}/lib

libfuseinstall:	libfuse
		cd libcf; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" install

bininstall:	bin
		cd fuv; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" install

fesinstall:	fes
		cd fes; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" install

analinstall:	analysis
		cd analysis; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" install

jitinstall:	jitter
		cd cal/jitter; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" install

libcfitsioclean:
	-	cd cfitsio; ${MAKE} clean; /bin/rm -f libcfitsio-${FITSVER}.so

libcfitsiodistclean:
	-	cd cfitsio; ${MAKE} distclean; /bin/rm -f libcfitsio-${FITSVER}.so
		cd ../lib; /bin/rm -f libcfitsio-${FITSVER}.so

libslaclean:
	-	SYSTEM="${PLATFORM}"; export SYSTEM; \
		cd slalib; ./mk clean; /bin/rm -f libsla.a libsla.so

libsladistclean:
	-	SYSTEM="${PLATFORM}"; export SYSTEM; \
		cd slalib; ./mk unbuild
		cd ../lib; /bin/rm -f libsla.so

libfuseclean:
		cd libcf; ${MAKE} clean

libfusedistclean:
		cd libcf; ${MAKE} distclean

binclean:
		cd fuv; ${MAKE} clean

bindistclean:
		cd fuv; ${MAKE} distclean

fesclean:
		cd fes; ${MAKE} clean

fesdistclean:
		cd fes; ${MAKE} distclean

analclean:
		cd analysis; ${MAKE} clean

analdistclean:
		cd analysis; ${MAKE} distclean

jitclean:
		cd cal/jitter; ${MAKE} clean

jitdistclean:
		cd cal/jitter; ${MAKE} distclean

