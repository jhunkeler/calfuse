
CALFUSEDIR=	${PWD}/..
PLATFORM=	x86_64
SHARED=		-shared -fPIC

# Symbols for make
MAKE=		make

#Symbols used for compiling
CC=		gcc
OPT=		-Wall -g -DCFORTRAN -Dg77Fortran -Df2cFortran
CFLAGS=		${OPT} -I${CALFUSEDIR}/include
LIBS=		-lc -lm -lnsl -ldl -lgfortran -lcfitsio

install:	libinstall bininstall analinstall jitinstall # fesinstall

libinstall:	libslainstall libfuseinstall

clean:		binclean fesclean analclean libclean jitclean

distclean:	bindistclean fesdistclean analdistclean libdistclean jitdistclean

libclean:	libslaclean libfuseclean

libdistclean:	libsladistclean libfusedistclean

libsla:		
		SYSTEM="${PLATFORM}"; export SYSTEM; \
		FFLAGS="${OPT}"; export FFLAGS; \
		cd slalib; ./mk build; ${CC} ${SHARED} -o libsla.so *.o ${LIBS}

libfuse:
		cd libcf; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT} ${SHARED}" all

bin:
		cd fuv; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" all

fes:
		cd fes; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" all

analysis:
		cd analysis; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" all

jitter:
		cd cal/jitter; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" all

libslainstall:	libsla
		cd slalib; cp libsla.so ${CALFUSEDIR}/lib

libfuseinstall:	libfuse
		cd libcf; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" install

bininstall:	bin
		cd fuv; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" install

fesinstall:	fes
		cd fes; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" install

analinstall:	analysis
		cd analysis; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" install

jitinstall:	jitter
		cd cal/jitter; ${MAKE} CALFUSEDIR="${CALFUSEDIR}" \
		CC="${CC}" OPT="${OPT}" install

libslaclean:
	-	SYSTEM="${PLATFORM}"; export SYSTEM; \
		cd slalib; ./mk clean; /bin/rm -f libsla.a libsla.so

libsladistclean:
	-	SYSTEM="${PLATFORM}"; export SYSTEM; \
		cd slalib; ./mk unbuild
		cd ../lib; /bin/rm -f libsla.so

libfuseclean:
		cd libcf; ${MAKE} clean

libfusedistclean:
		cd libcf; ${MAKE} distclean

binclean:
		cd fuv; ${MAKE} clean

bindistclean:
		cd fuv; ${MAKE} distclean

fesclean:
		cd fes; ${MAKE} clean

fesdistclean:
		cd fes; ${MAKE} distclean

analclean:
		cd analysis; ${MAKE} clean

analdistclean:
		cd analysis; ${MAKE} distclean

jitclean:
		cd cal/jitter; ${MAKE} clean

jitdistclean:
		cd cal/jitter; ${MAKE} distclean

