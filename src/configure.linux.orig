#!/bin/sh

echo "***********************************"
echo "***** Preparing Makefiles *********"
echo "******** for Linux ****************"
echo "***********************************"

cp Makefile.Linux Makefile
cp fuv/Makefile.Linux fuv/Makefile
cp fes/Makefile.Linux fes/Makefile
cp analysis/Makefile.Linux analysis/Makefile
cp libcf/Makefile.Linux libcf/Makefile
cp cal/jitter/Makefile.Linux cal/jitter/Makefile
cp slalib/mk.sv slalib/mk

echo "***********************************"
echo "***** Configuring cfitsio *********"
echo "***********************************"


cd cfitsio
./configure
cd ..

echo "***********************************"
echo "***** Done configuring cfitsio ****"
echo "***********************************"

FC=""
for ac_prog in gfortran g77
do
# Extract the first word of "$ac_prog", so it can be a program name with args.
  set dummy $ac_prog; ac_word=$2
  echo "checking for $ac_word..."  
  IFS="${IFS= 	}"; ac_save_ifs="$IFS"; IFS=":"
  ac_dummy="$PATH"
  for ac_dir in $ac_dummy; do
    test -z "$ac_dir" && ac_dir=.
    if test -f $ac_dir/$ac_word; then
      FC="$ac_prog"
      break
    fi
  done
  IFS="$ac_save_ifs"
  if test -n "$FC"; then
    echo "     yes"
  else
    echo "     no"
  fi
  test -n "$FC" && break
done
test -n "$FC" || FC="nope"

if test $FC = 'nope' ; then
  echo "Warning: No acceptable fortran compiler was found. Please install one from the GNU compilers."
  echo "Read INSTALLING_CalFUSEv3.2.1 for details."
else
  if test $FC = 'g77' ; then
    for mk in Makefile fuv/Makefile analysis/Makefile libcf/Makefile cal/jitter/Makefile
    do
      mv $mk ${mk}.sv
      sed -e "s/-lgfortran/-lg2c/g" ${mk}.sv > $mk
    done  
    sed -e "s/gfortran/g77/g" slalib/mk.sv > slalib/mk
  fi 
  echo
  echo "Type 'make clean' then 'make -e install'"
fi
